
<a name="api-definitions"></a>
## Definitions

<a name="api-batchitemresponse"></a>
### BatchItemResponse
A status corresponding to one individual Event's publishing attempt.


|Name|Description|Schema|
|---|---|---|
|**detail**  <br>*optional*|Human readable information about the failure on this item. Items that are not "submitted" should have<br>a description.|string|
|**eid**  <br>*optional*|eid of the corresponding item. Will be absent if missing on the incoming Event.|string(uuid)|
|**publishing_status**  <br>*required*|Indicator of the submission of the Event within a Batch.<br>- "submitted" indicates successful submission, including commit on he underlying broker.<br>- "failed" indicates the message submission was not possible and can be resubmitted if so desired.<br>- "aborted" indicates that the submission of this item was not attempted any further due to a failure<br>  on another item in the batch.|enum (submitted, failed, aborted)|
|**step**  <br>*optional*|Indicator of the step in the publishing process this Event reached.<br><br>In Items that "failed" means the step of the failure.<br><br>- "none" indicates that nothing was yet attempted for the publishing of this Event. Should be present<br>  only in the case of aborting the publishing during the validation of another (previous) Event.<br>- "validating", "enriching", "partitioning" and "publishing" indicate all the corresponding steps of the<br>  publishing process.|enum (none, validating, enriching, partitioning, publishing)|


<a name="api-businessevent"></a>
### BusinessEvent
A Business Event.

Usually represents a status transition in a Business process.

*Polymorphism* : Composition


|Name|Description|Schema|
|---|---|---|
|**metadata**  <br>*required*||[metadata](#api-businessevent-metadata)|

<a name="api-businessevent-metadata"></a>
**metadata**

|Name|Description|Schema|
|---|---|---|
|**eid**  <br>*required*|Identifier of this Event.<br><br>Clients MUST generate this value and it SHOULD be guaranteed to be unique from the<br>perspective of the producer. Consumers MIGHT use this value to assert uniqueness of reception<br>of the Event.  <br>**Example** : `"105a76d8-db49-4144-ace7-e683e8f4ba46"`|string(uuid)|
|**event_type**  <br>*optional*|The EventType of this Event. This is enriched by Nakadi on reception of the Event based on the<br>endpoint where the Producer sent the Event to.<br><br>If provided MUST match the endpoint. Failure to do so will cause rejection of the Event.  <br>**Example** : `"pennybags.payment-business-event"`|string|
|**flow_id**  <br>*optional*|The flow-id of the producer of this Event. As this is usually a HTTP header, this is enriched<br>from the header into the metadata by Nakadi to avoid clients having to explicitly copy this.  <br>**Example** : `"JAh6xH4OQhCJ9PutIV_RYw"`|string|
|**occurred_at**  <br>*required*|Timestamp of creation of the Event generated by the producer.  <br>**Example** : `"1996-12-19T16:39:57-08:00"`|string(date-time)|
|**parent_eids**  <br>*optional*||< string(uuid) > array|
|**partition**  <br>*optional*|Indicates the partition assigned to this Event.<br><br>Required to be set by the client if partition strategy of the EventType is 'user_defined'.  <br>**Example** : `"0"`|string|
|**received_at**  <br>*optional*|Timestamp of the reception of the Event by Nakadi. This is enriched upon reception of the<br>Event.<br>If set by the producer Event will be rejected.  <br>**Example** : `"1996-12-19T16:39:57-08:00"`|string(date-time)|


<a name="api-cursor"></a>
### Cursor

|Name|Description|Schema|
|---|---|---|
|**offset**  <br>*required*|Offset of the event being pointed to.|string|
|**partition**  <br>*required*|Id of the partition pointed to by this cursor.|string|


<a name="api-datachangeevent"></a>
### DataChangeEvent
A Data change Event.

Represents a change on a resource.

*Polymorphism* : Composition


|Name|Description|Schema|
|---|---|---|
|**data_op**  <br>*required*|The type of operation executed on the entity.<br>* C: Creation<br>* U: Update<br>* D: Deletion<br>* S: Snapshot|enum (C, U, D, S)|
|**data_type**  <br>*required*|**Example** : `"pennybags:order"`|string|
|**metadata**  <br>*required*||[metadata](#api-datachangeevent-metadata)|

<a name="api-datachangeevent-metadata"></a>
**metadata**

|Name|Description|Schema|
|---|---|---|
|**eid**  <br>*required*|Identifier of this Event.<br><br>Clients MUST generate this value and it SHOULD be guaranteed to be unique from the<br>perspective of the producer. Consumers MIGHT use this value to assert uniqueness of reception<br>of the Event.  <br>**Example** : `"105a76d8-db49-4144-ace7-e683e8f4ba46"`|string(uuid)|
|**event_type**  <br>*optional*|The EventType of this Event. This is enriched by Nakadi on reception of the Event based on the<br>endpoint where the Producer sent the Event to.<br><br>If provided MUST match the endpoint. Failure to do so will cause rejection of the Event.  <br>**Example** : `"pennybags.payment-business-event"`|string|
|**flow_id**  <br>*optional*|The flow-id of the producer of this Event. As this is usually a HTTP header, this is enriched<br>from the header into the metadata by Nakadi to avoid clients having to explicitly copy this.  <br>**Example** : `"JAh6xH4OQhCJ9PutIV_RYw"`|string|
|**occurred_at**  <br>*required*|Timestamp of creation of the Event generated by the producer.  <br>**Example** : `"1996-12-19T16:39:57-08:00"`|string(date-time)|
|**parent_eids**  <br>*optional*||< string(uuid) > array|
|**partition**  <br>*optional*|Indicates the partition assigned to this Event.<br><br>Required to be set by the client if partition strategy of the EventType is 'user_defined'.  <br>**Example** : `"0"`|string|
|**received_at**  <br>*optional*|Timestamp of the reception of the Event by Nakadi. This is enriched upon reception of the<br>Event.<br>If set by the producer Event will be rejected.  <br>**Example** : `"1996-12-19T16:39:57-08:00"`|string(date-time)|


<a name="api-datachangeeventqualifier"></a>
### DataChangeEventQualifier
Indicators of a `DataChangeEvent`'s referred data type and the type of operations done on them.


|Name|Description|Schema|
|---|---|---|
|**data_op**  <br>*required*|The type of operation executed on the entity.<br>* C: Creation<br>* U: Update<br>* D: Deletion<br>* S: Snapshot|enum (C, U, D, S)|
|**data_type**  <br>*required*|**Example** : `"pennybags:order"`|string|


<a name="api-event"></a>
### Event
**Note** The Event definition will be externalized in future versions of this document.

A basic payload of an Event. The actual schema is dependent on the information configured for the
EventType, as is its enforcement (see POST /event-types). Setting of metadata properties are
dependent on the configured enrichment as well.

For explanation on default configurations of validation and enrichment, see documentation of
`EventType.category`.

For concrete examples of what will be enforced by Nakadi see the objects BusinessEvent and
DataChangeEvent below.

*Type* : object


<a name="api-eventmetadata"></a>
### EventMetadata
Metadata for this Event.

Contains commons fields for both Business and DataChange Events. Most are enriched by Nakadi upon
reception, but they in general MIGHT be set by the client.


|Name|Description|Schema|
|---|---|---|
|**metadata**  <br>*required*||[metadata](#api-eventmetadata-metadata)|

<a name="api-eventmetadata-metadata"></a>
**metadata**

|Name|Description|Schema|
|---|---|---|
|**eid**  <br>*required*|Identifier of this Event.<br><br>Clients MUST generate this value and it SHOULD be guaranteed to be unique from the<br>perspective of the producer. Consumers MIGHT use this value to assert uniqueness of reception<br>of the Event.  <br>**Example** : `"105a76d8-db49-4144-ace7-e683e8f4ba46"`|string(uuid)|
|**event_type**  <br>*optional*|The EventType of this Event. This is enriched by Nakadi on reception of the Event based on the<br>endpoint where the Producer sent the Event to.<br><br>If provided MUST match the endpoint. Failure to do so will cause rejection of the Event.  <br>**Example** : `"pennybags.payment-business-event"`|string|
|**flow_id**  <br>*optional*|The flow-id of the producer of this Event. As this is usually a HTTP header, this is enriched<br>from the header into the metadata by Nakadi to avoid clients having to explicitly copy this.  <br>**Example** : `"JAh6xH4OQhCJ9PutIV_RYw"`|string|
|**occurred_at**  <br>*required*|Timestamp of creation of the Event generated by the producer.  <br>**Example** : `"1996-12-19T16:39:57-08:00"`|string(date-time)|
|**parent_eids**  <br>*optional*||< string(uuid) > array|
|**partition**  <br>*optional*|Indicates the partition assigned to this Event.<br><br>Required to be set by the client if partition strategy of the EventType is 'user_defined'.  <br>**Example** : `"0"`|string|
|**received_at**  <br>*optional*|Timestamp of the reception of the Event by Nakadi. This is enriched upon reception of the<br>Event.<br>If set by the producer Event will be rejected.  <br>**Example** : `"1996-12-19T16:39:57-08:00"`|string(date-time)|


<a name="api-eventstreambatch"></a>
### EventStreamBatch
One chunk of events in a stream. A batch consists of an array of `Event`s plus a `Cursor` pointing to
the offset of the last Event in the stream.

The size of the array of Event is limited by the parameters used to initialize a Stream.

If acting as a keep alive message (see `GET /event-type/{name}/events`) the events array will be
omitted.

Sequential batches might present repeated cursors if no new events have arrived.


|Name|Description|Schema|
|---|---|---|
|**cursor**  <br>*required*||[Cursor](#api-cursor)|
|**events**  <br>*optional*||< [Event](#api-event) > array|


<a name="api-eventtype"></a>
### EventType
An event type defines the schema and its runtime properties.


|Name|Description|Schema|
|---|---|---|
|**category**  <br>*required*|Defines the category of this EventType.<br><br>The value set will influence, if not set otherwise, the default set of validation-strategies,<br>enrichment-strategies, and the effective schema for validation in the following way:<br><br>- `undefined`: No predefined changes apply. The effective schema for the validation is exactly the<br>  same as the `EventTypeSchema`.<br>  Default validation_strategy for this `EventType` is `['schema-validation']`.<br><br>- `data`: Events of this category will be DataChangeEvents. The effective schema during the<br>  validation contains `metadata`,<br>  and adds fields `data_op` and `data_type`. The passed EventTypeSchema defines the schema of<br>  `data`.<br><br>- `business`: Events of this category will be BusinessEvents. The effective schema for validation<br>  contains `metadata` and any additionally defined properties passed in the `EventTypeSchema`<br>  directly on top level of the Event. If name conflicts arise, creation of this EventType will be<br>  rejected.<br>  Default validation_strategy for this `EventType` is `['schema-validation']`.|enum (undefined, data, business)|
|**data_key_fields**  <br>*optional*|Indicators of the path of the properties that constitute the primary key (identifier) of the data<br>within this Event.<br>If set MUST be a valid required field as defined in the schema.<br>(TBD should be required? Is applicable only to both Business and DataChange Events?)|< string > array|
|**default_statistics**  <br>*optional*|Statistics of this EventType used for optimization purposes. Internal use of these values might<br>change over time.<br>(TBD: measured statistics)|object|
|**enrichment_strategies**  <br>*optional*|Determines the enrichment to be performed on an Event upon reception. Enrichment is performed once<br>upon reception (and after validation) of an Event and is only possible on fields that are not<br>defined on the incoming Event.<br><br>For event types in categories 'business' or 'data' it's mandatory to use METADATA_ENRICHMENT strategy. For<br>'undefined' event types it's not possible to use this strategy, since metadata field is not required.<br><br>See documentation for the write operation for details on behaviour in case of unsuccessful<br>enrichment.|< enum (METADATA_ENRICHMENT) > array|
|**name**  <br>*required*|Name of this EventType. Encodes the owner/responsible for this EventType.<br><br>The name for the EventType SHOULD follow the pattern, but is not enforced<br>'stups_owning_application.event-type', for example 'gizig.price-change'.<br><br>The components of the name are:<br>* Organization: the organizational unit where the team is located; can be omitted.<br>* Team name: name of the team responsible for owning application; can be omitted.<br>* Owning application: SHOULD match the field owning_application; indicates<br>* EventType name: name of this EventType; SHOULD end in ChangeEvent for DataChangeEvents; MUST be<br>in the past tense for BusinessEvents.<br><br>(TBD: how to deal with organizational changes? Should be reflected on the name of the EventType?<br>Isn't it better to omit [organization:team] completely?)  <br>**Example** : `"order.ORDER_CANCELLED"`|string|
|**owning_application**  <br>*required*|Indicator of the (Stups) Application owning this `EventType`.  <br>**Example** : `"price-service"`|string|
|**partition_key_fields**  <br>*optional*|Required when 'partition_resolution_strategy' is set to 'hash'. Must be absent otherwise.<br>Indicates the fields used for evaluatiion the partition of Events of this type.<br><br>If set it MUST be a valid required field as defined in the schema.|< string > array|
|**partition_strategy**  <br>*optional*|Determines how the assignment of the event to a partition should be handled.<br><br>For details of possible values, see GET /registry/partition-strategies.  <br>**Default** : `"random"`|string|
|**schema**  <br>*required*|The schema for this EventType. Submitted events will be validated against it.|object|
|**validation_strategies**  <br>*optional*|Determines the validation that has to be executed upon reception of Events of this type. Events are<br>rejected if any of the rules fail (see details of Problem response on the Event publishing<br>methods).<br><br>Rule evaluation order is the same as in this array.<br><br>If not explicitly set, default value will respect the definition of the `EventType.category`.|< string > array|


<a name="api-eventtypeschema"></a>
### EventTypeSchema

|Name|Description|Schema|
|---|---|---|
|**schema**  <br>*required*|The schema as string in the syntax defined in the field type. Failure to respect the syntax will<br>fail any operation on an EventType.<br><br>To have a generic, undefined schema it is possible to define the schema as<br>`"schema": "{\"additionalProperties\": true}"`.|string|
|**type**  <br>*required*|The type of schema definition. Currently only JSON_SCHEMA v4 is supported, but in the future there<br>could be others.|enum (JSON_SCHEMA)|


<a name="api-eventtypestatistics"></a>
### EventTypeStatistics
Operational statistics for an EventType. This data is generated by Nakadi based on the runtime and
might be used to guide changes in internal parameters.


|Name|Description|Schema|
|---|---|---|
|**message_size**  <br>*required*|Average message size for each Event of this EventType. Includes in the count the whole serialized<br>form of the event, including metadata.<br>Measured in bytes.|integer|
|**messages_per_minute**  <br>*required*|Write rate for events of this EventType. This rate encompasses all producers of this EventType for<br>a Nakadi cluster.<br><br>Measured in event count per minute.|integer|
|**read_parallelism**  <br>*required*|Amount of parallel readers (consumers) to this EventType.|integer|
|**write_parallelism**  <br>*required*|Amount of parallel writers (producers) to this EventType.|integer|


<a name="api-metrics"></a>
### Metrics
*Type* : object


<a name="api-partition"></a>
### Partition
Partition information. Can be helpful when trying to start a stream using an unmanaged API.

This information is not related to the state of the consumer clients.


|Name|Description|Schema|
|---|---|---|
|**newest_available_offset**  <br>*required*|An offset of the newest available Event in that partition. This value will be changing upon<br>reception of new events for this partition by Nakadi.<br><br>This value can be used to construct a cursor when opening streams (see<br>`GET /event-type/{name}/events` for details).<br><br>Might assume the special name BEGIN, meaning a pointer to the offset of the oldest available<br>event in the partition.|string|
|**oldest_available_offset**  <br>*required*|An offset of the oldest available Event in that partition. This value will be changing upon<br>removal of Events from the partition by the background archiving/cleanup mechanism.|string|
|**partition**  <br>*required*||string|


<a name="api-problem"></a>
### Problem

|Name|Description|Schema|
|---|---|---|
|**detail**  <br>*optional*|A human readable explanation specific to this occurrence of the problem.  <br>**Example** : `"Connection to database timed out"`|string|
|**instance**  <br>*optional*|An absolute URI that identifies the specific occurrence of the problem.<br>It may or may not yield further information if dereferenced.|string|
|**status**  <br>*required*|The HTTP status code generated by the origin server for this occurrence of the problem.  <br>**Example** : `503`|integer(int32)|
|**title**  <br>*required*|A short, summary of the problem type. Written in English and readable for engineers (usually not<br>suited for non technical stakeholders and not localized)  <br>**Example** : `"Service Unavailable"`|string|
|**type**  <br>*required*|An absolute URI that identifies the problem type.  When dereferenced, it SHOULD provide<br>human-readable API documentation for the problem type (e.g., using HTML).<br>This Problem object is the same as provided by https://github.com/zalando/problem  <br>**Example** : `"http://httpstatus.es/503"`|string|



